<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EdgeFamily3 Bağış Sistemi</title>
<style>
  body {
    background-color: #121212;
    color: #f0f0f0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 0; max-width: 700px; margin: auto;
  }
  nav {
    background: linear-gradient(90deg, #0066cc, #003366);
    padding: 15px 20px;
    display: flex;
    justify-content: space-around;
  }
  nav a {
    color: white;
    font-weight: bold;
    text-decoration: none;
    cursor: pointer;
  }
  section {
    margin-top: 30px;
    background-color: #1a1a1a;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 0 15px rgba(0, 102, 204, 0.6);
  }
  h1, h2 {
    color: #66aaff;
  }
  form {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  input, textarea, button {
    padding: 10px;
    font-size: 1.1rem;
    border-radius: 8px;
    border: none;
  }
  input, textarea {
    width: 100%;
  }
  button {
    background-color: #556ee6;
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #3a53b3;
  }
  #card-element {
    background: white;
    color: black;
    padding: 10px;
    border-radius: 6px;
    margin-bottom: 12px;
  }
  #payment-message, #paypal-message {
    margin-top: 15px;
    font-size: 1.1rem;
    min-height: 1.4em;
  }
  .hidden {
    display: none;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    color: white;
  }
  table th, table td {
    border: 1px solid #114b5f;
    padding: 8px;
    text-align: left;
  }
  #paypal-button-container {
    margin-top: 10px;
  }
  .payment-method-buttons button {
    margin-right: 10px;
  }
</style>

<script src="https://js.stripe.com/v3/"></script>
<script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=USD"></script>
</head>
<body>

<nav>
  <a id="nav-register">Kayıt</a>
  <a id="nav-payment">Ödeme</a>
  <a id="nav-vip">VIP Talep</a>
  <a id="nav-admin">Admin Panel</a>
</nav>

<section id="section-register">
  <h1>Kayıt Ol</h1>
  <form id="register-form">
    <input type="text" id="firstname" placeholder="Adınız" required />
    <input type="text" id="lastname" placeholder="Soyadınız" required />
    <input type="email" id="email" placeholder="E-posta" required />
    <button type="submit">Kayıt Ol</button>
  </form>
  <div id="register-message"></div>
</section>

<section id="section-payment" class="hidden">
  <h1>Ödeme Yap</h1>
  <input id="amount" type="number" min="1" step="0.01" value="10" placeholder="Ödeme Tutarı (USD)" />

  <div class="payment-method-buttons" style="margin: 15px 0;">
    <button id="btn-paypal-2d">2D Ödeme (PayPal)</button>
    <button id="btn-stripe-3d">3D Ödeme (Stripe)</button>
  </div>

  <!-- PayPal Bölümü -->
  <div id="paypal-container" class="hidden">
    <div id="paypal-button-container"></div>
    <div id="paypal-message"></div>
  </div>

  <!-- Stripe Bölümü -->
  <div id="stripe-container" class="hidden">
    <div id="card-element"></div>
    <button id="submit-payment">Stripe ile Öde</button>
    <div id="payment-message"></div>
  </div>
</section>

<section id="section-vip" class="hidden">
  <h1>VIP Bağış Talep Formu</h1>
  <form id="vip-form">
    <input type="text" id="vip-name" placeholder="Ad Soyad" required />
    <input type="email" id="vip-email" placeholder="E-posta" required />
    <input type="number" id="vip-amount" min="1" step="0.01" placeholder="Talep Edilen Miktar (USD)" required />
    <textarea id="vip-message" rows="4" placeholder="Mesajınız (opsiyonel)"></textarea>
    <button type="submit">Gönder</button>
  </form>
  <div id="vip-message-result"></div>
</section>

<section id="section-admin" class="hidden">
  <h1>Admin Panel</h1>
  <form id="admin-login-form">
    <input type="text" id="admin-user" placeholder="Kullanıcı Adı" required />
    <input type="password" id="admin-pass" placeholder="Şifre" required />
    <button type="submit">Giriş</button>
  </form>
  <section id="admin-data" class="hidden">
    <h2>Kayıtlı Kullanıcılar</h2>
    <table id="donor-table">
      <thead><tr><th>Ad</th><th>Soyad</th><th>E-posta</th></tr></thead>
      <tbody></tbody>
    </table>
    <h2>VIP Talepleri</h2>
    <table id="vip-table">
      <thead><tr><th>Ad Soyad</th><th>E-posta</th><th>Miktar</th><th>Mesaj</th></tr></thead>
      <tbody></tbody>
    </table>
    <button id="admin-logout">Çıkış Yap</button>
  </section>
</section>

<script>
  // Navigasyon kontrolü
  const navRegister = document.getElementById('nav-register');
  const navPayment = document.getElementById('nav-payment');
  const navVip = document.getElementById('nav-vip');
  const navAdmin = document.getElementById('nav-admin');

  const sectionRegister = document.getElementById('section-register');
  const sectionPayment = document.getElementById('section-payment');
  const sectionVip = document.getElementById('section-vip');
  const sectionAdmin = document.getElementById('section-admin');

  function showSection(section) {
    sectionRegister.classList.add('hidden');
    sectionPayment.classList.add('hidden');
    sectionVip.classList.add('hidden');
    sectionAdmin.classList.add('hidden');
    section.classList.remove('hidden');
  }

  navRegister.onclick = () => showSection(sectionRegister);
  navPayment.onclick = () => showSection(sectionPayment);
  navVip.onclick = () => showSection(sectionVip);
  navAdmin.onclick = () => showSection(sectionAdmin);

  showSection(sectionRegister);

  // Kayıt formu
  const registerForm = document.getElementById('register-form');
  const registerMessage = document.getElementById('register-message');

  registerForm.addEventListener('submit', e => {
    e.preventDefault();
    const firstname = document.getElementById('firstname').value.trim();
    const lastname = document.getElementById('lastname').value.trim();
    const email = document.getElementById('email').value.trim();

    if (!firstname || !lastname || !email) {
      alert('Lütfen tüm alanları doldurun.');
      return;
    }

    fetch('http://localhost:4242/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ firstname, lastname, email })
    })
    .then(res => res.json())
    .then(data => {
      if (data.error) {
        registerMessage.textContent = data.error;
      } else {
        registerMessage.textContent = 'Kayıt başarılı! Şimdi ödeme yapabilirsiniz.';
        registerForm.reset();
      }
    })
    .catch(() => registerMessage.textContent = 'Sunucu hatası!');
  });

  // Ödeme butonları
  const btnPaypal2d = document.getElementById('btn-paypal-2d');
  const btnStripe3d = document.getElementById('btn-stripe-3d');
  const paypalContainer = document.getElementById('paypal-container');
  const stripeContainer = document.getElementById('stripe-container');

  btnPaypal2d.onclick = () => {
    paypalContainer.classList.remove('hidden');
    stripeContainer.classList.add('hidden');
  };
  btnStripe3d.onclick = () => {
    stripeContainer.classList.remove('hidden');
    paypalContainer.classList.add('hidden');
  };

  // Stripe setup
  const stripe = Stripe('YOUR_STRIPE_PUBLISHABLE_KEY');
  const elements = stripe.elements();
  const card = elements.create('card');
  card.mount('#card-element');

  const submitPayment = document.getElementById('submit-payment');
  const paymentMessage = document.getElementById('payment-message');

  submitPayment.addEventListener('click', async () => {
    paymentMessage.textContent = '';
    const amount = parseFloat(document.getElementById('amount').value);

    if (!amount || amount <= 0) {
      paymentMessage.textContent = 'Geçerli bir tutar giriniz.';
      return;
    }
    submitPayment.disabled = true;

    try {
      const res = await fetch('http://localhost:4242/create-payment-intent', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ amount })
      });
      const data = await res.json();

      if (data.error) {
        paymentMessage.textContent = 'Hata: ' + data.error;
        submitPayment.disabled = false;
        return;
      }

      const result = await stripe.confirmCardPayment(data.clientSecret, {
        payment_method: { card }
      });

      if (result.error) {
        paymentMessage.textContent = 'Ödeme başarısız: ' + result.error.message;
      } else if (result.paymentIntent.status === 'succeeded') {
        paymentMessage.textContent = 'Ödeme başarılı! Teşekkür ederiz.';
      }
    } catch (err) {
      paymentMessage.textContent = 'Sunucu hatası: ' + err.message;
    }

    submitPayment.disabled = false;
  });

  // PayPal setup
  paypal.Buttons({
    style: { layout: 'vertical', color: 'blue', shape: 'rect', label: 'paypal' },
    createOrder: function(data, actions) {
      const amount = parseFloat(document.getElementById('amount').value);
      if (!amount || amount <= 0) {
        document.getElementById('paypal-message').textContent = 'Geçerli bir tutar giriniz.';
        return;
      }
      document.getElementById('paypal-message').textContent = '';
      return actions.order.create({
        purchase_units: [{ amount: { value: amount.toFixed(2) } }]
      });
    },
    onApprove: function(data, actions) {
      return actions.order.capture().then(function(details) {
        document.getElementById('paypal-message').textContent = 'Teşekkürler, ' + details.payer.name.given_name + '!';
      });
    },
    onError: function(err) {
      document.getElementById('paypal-message').textContent = 'Ödeme sırasında hata: ' + err;
    }
  }).render('#paypal-button-container');

  // VIP Talep Formu
  const vipForm = document.getElementById('vip-form');
  const vipMessageResult = document.getElementById('vip-message-result');

  vipForm.addEventListener('submit', e => {
    e.preventDefault();
    const name = document.getElementById('vip-name').value.trim();
    const email = document.getElementById('vip-email').value.trim();
    const amount = document.getElementById('vip-amount').value.trim();
    const message = document.getElementById('vip-message').value.trim();

    if (!name || !email || !amount || Number(amount) <= 0) {
      alert('Lütfen zorunlu alanları doldurun ve geçerli tutar girin.');
      return;
    }

    fetch('http://localhost:4242/vip-request', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, email, amount, message })
    })
    .then(res => res.json())
    .then(data => {
      if (data.error) {
        vipMessageResult.textContent = data.error;
      } else {
        vipMessageResult.textContent = 'VIP talebiniz alındı, teşekkürler!';
        vipForm.reset();
      }
    })
    .catch(() => vipMessageResult.textContent = 'Sunucu hatası!');
  });

  // Admin Paneli
  const adminLoginForm = document.getElementById('admin-login-form');
  const adminDataSection = document.getElementById('admin-data');
  const donorTableBody = document.querySelector('#donor-table tbody');
  const vipTableBody = document.querySelector('#vip-table tbody');

  adminLoginForm.addEventListener('submit', e => {
    e.preventDefault();
    const username = document.getElementById('admin-user').value.trim();
    const password = document.getElementById('admin-pass').value.trim();

    fetch('http://localhost:4242/admin-login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password })
    })
    .then(res => {
      if (res.status === 200) return res.json();
      else throw new Error('Giriş başarısız');
    })
    .then(() => {
      adminLoginForm.classList.add('hidden');
      adminDataSection.classList.remove('hidden');
      loadAdminData();
    })
    .catch(() => alert('Kullanıcı adı veya şifre yanlış'));
  });

  document.getElementById('admin-logout').addEventListener('click', () => {
    adminDataSection.classList.add('hidden');
    adminLoginForm.classList.remove('hidden');
    adminLoginForm.reset();
  });

  function loadAdminData() {
    fetch('http://localhost:4242/admin-data')
    .then(res => res.json())
    .then(data => {
      donorTableBody.innerHTML = '';
      vipTableBody.innerHTML = '';

      data.users.forEach(user => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${user.firstname}</td><td>${user.lastname}</td><td>${user.email}</td>`;
        donorTableBody.appendChild(tr);
      });

      data.vip.forEach(vip => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${vip.name}</td><td>${vip.email}</td><td>${vip.amount}</td><td>${vip.message || '-'}</td>`;
        vipTableBody.appendChild(tr);
      });
    });
  }
</script>

</body>
</html>